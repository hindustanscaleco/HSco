
<!DOCTYPE html>

<html lang="en">
	<!--begin::Head-->
	<head><base href="">
		{% load static %}
		<meta charset="utf-8" />
		<title></title>
		<meta name="description" content="Updates and statistics" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<!--begin::Fonts-->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
		<!--end::Fonts-->
		<!--begin::Page Vendors Styles(used by this page)-->
		<link href="{% static 'plugins/custom/fullcalendar/fullcalendar.bundle.css' %}" rel="stylesheet" type="text/css" />
		<!--end::Page Vendors Styles-->
		<!--begin::Global Theme Styles(used by all pages)-->
		<link href="{% static 'plugins/global/plugins.bundle.css' %}" rel="stylesheet" type="text/css" />
		<link href="{% static 'plugins/custom/prismjs/prismjs.bundle.css' %}" rel="stylesheet" type="text/css" />
		<link href="{% static 'css/style.bundle.css' %}" rel="stylesheet" type="text/css" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>

		<!--end::Global Theme Styles-->
		<!--begin::Layout Themes(used by all pages)-->
		<!--end::Layout Themes-->
		<link rel="shortcut icon" href="assets/media/logos/favicon.ico" />
	</head>
	<!--end::Head-->
	<!--begin::Body-->
	<body id="kt_body" class="header-mobile-fixed subheader-enabled aside-enabled aside-fixed aside-secondary-enabled page-loading">
		<!--begin::Main-->
		<!--begin::Header Mobile-->
		<div id="kt_header_mobile" class="header-mobile">
			<!--begin::Logo-->
			<a href="/">
				<h1>HSCo</h1>
			</a>
			<!--end::Logo-->
			<!--begin::Toolbar-->
			<div class="d-flex align-items-center">
				<button class="btn p-0 burger-icon burger-icon-left" id="kt_aside_mobile_toggle">
					<span></span>
				</button>
			</div>
			<!--end::Toolbar-->
		</div>
		<!--end::Header Mobile-->
		<div class="d-flex flex-column flex-root">
			<!--begin::Page-->
			<div class="d-flex flex-row flex-column-fluid page">
				<!--begin::Aside-->
					{% include 'base_templates/aside.html' %}


				<!--end::Aside-->
				<!--begin::Wrapper-->
				<div class="d-flex flex-column flex-row-fluid wrapper" id="kt_wrapper">
					<!--begin::Content-->
					<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
						<!--begin::Subheader-->
						<div class="" id="kt_subheader">
							<div class="container-fluid">
								<!--begin::Info-->


<style>

* {
color:;
}
  .faicons {
  font-size: 18px;
  margin-top: 20px;
  padding-left: 10px;
  padding-right: 10px;
  color: #5a5c69;
  }

  .icon-border {
  border: 1px solid #d1d3e2;
  border-radius: 5px 1px 1px 5px;
  border-right: none;


  }

  .control-label {
  color: black;

  }


  table {
  border-collapse: collapse;
  width: 90%;
  font-size: 13px;
  border-color: black;


}


th {

  font-size: 15px;
    border: 1px solid black;
    text-align: left;
    font-weight: 900;
    color: black;

}

td {
  border: 1px solid black;
  padding: 5px;
}

.alignL {
  text-align: left; padding-left: 15px;
  color: black;
  font-weight: 600;
  font-size: 12px;
}

.alignR {
  text-align: right; padding-right: 10px;
}

</style>

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content" style="background-color: white;">


        <!-- Topbar -->
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid" style="overflow-x:auto;" >

      <!-- Page Heading -->
          <!--<div class="d-sm-flex align-items-center justify-content-between mb-4">-->
      <!--<center>  <h1 style="color: black; font-size: 25px;">Custom Report</h1>  </center>-->
            <!--<a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"  onclick="exportHTMLTableToCSV('onsite_report.csv', 'MyTable')"><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>-->
          <!--</div>-->




<br>
  <div >


      <br>
      <br>
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
      <center>  <h1 style="color: black; font-size: 25px;">Custom Report</h1>  </center>
      <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"  onclick="ExportToExcel('xlsx')" ><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
    </div>



{% load replace_underscore %}
                 <table class="table2excel" id="tbl_exporttable_to_xls" data-tableName="Test Table 2">
        <tr>
            {% for lead in lead_list %}
                {% if forloop.first %}
                    {% for header in lead.keys %}
                        <th>{{ header|replace_underscore|title }}</th>
                    {% endfor %}
                {% endif %}
         </tr>
                <tr>
                    {% for key2,value in lead.items %}

                        {% if key2 == 'pi_history' %}

                            <td>
                                    <table>

                                         {% for val in value %}


                        {% if forloop.first %}
                                        <tr>
                    {% for header in val.keys %}
                                            {% if header == 'lead_id_id' %}
                                            {% else %}
                        <th>{{ header|replace_underscore|title }}</th>
                                            {% endif %}
                    {% endfor %}
                                        </tr>
                {% endif %}


                                            <tr>
                                                 <td>{{ val.id }}</td>
                                                <td><a href="http://139.59.76.87/media/{{ val.pi_history_file }}" >PI File</a></td>
                                                <td>{{ val.medium_of_selection }}</td>
                                                <td>{{ val.call_detail }}</td>
                                                <td>{{ val.entry_timedate_time }}</td>
                                            </tr>

                                        {% endfor %}
                                    </table>
                                </td>
                        {% elif key2 == 'followup_history' %}

                            <td>
                                    <table>

                                        {% for val in value %}
{% if forloop.first %}
                                        <tr>
                    {% for header in val.keys %}
                                            {% if forloop.first %}
                                            {% elif header == 'is_manual_mode' or header == 'is_auto_follow_deleted' or header == 'entry_timedate_time' or header == 'followup_history_file' or header == 'html_content' %}
                                            {% else %}
                        <th>{{ header|replace_underscore|title }}</th>
                                            {% endif %}
                    {% endfor %}
                                        </tr>
                {% endif %}
                                            <tr>
                                                <td>{{ val.follow_up_section_id }}</td>
                                                <td>{{ val.lead_id_id }}</td>
                                                <td>
                                                    {% with val.fields|slice:"1:-1" as list %}
                                                    {% for item in list.split %}
                                                    {% if forloop.last %}
                                                    <p>{{forloop.counter}}){{item|slice:"1:-1"}}</p>
                                                    {% else %}
                                                    <p>{{forloop.counter}}){{item|slice:"1:-2"}}</p>
                                                    {% endif %}
                                                    {% endfor %}
                                                    {% endwith %}

                                                </td>
                                                <td>{{ val.product_ids }}</td>
                                                <td>{{ val.is_email }}</td>
                                                <td>{{ val.is_whatsapp }}</td>
                                                <td>{{ val.is_call }}</td>
                                                <td>{{ val.is_sms }}</td>
                                                <td>{{ val.wa_msg }}</td>
                                                <td>{{ val.wa_no }}</td>
                                                <td>{{ val.email_subject }}</td>
                                                <td>{{ val.email_msg }}</td>
                                                 <td>{{ val.call_response }}</td>
                                                <td>{{ val.sms_msg }}</td>
                                                <td>{{val.sms_con}}</td>

                                                <td>{{val.entry_timedate}}</td>

                                            </tr>
                                        {% endfor %}
                                    </table>
                        </td>
                        {% elif key2 == 'payment_details' %}

                            <td>
                                    <table>

                                        {% for val in value %}
{% if forloop.first %}
                                        <tr>

                    {% for header in val.keys %}

                        <th>{{ header|replace_underscore|title }}</th>
                    {% endfor %}
                                        </tr>
                {% endif %}
                                            <tr>
                                                {% for value in val.values %}

                                                <td>{{ value }}</td>
                                                {% endfor %}

                                            </tr>
                                        {% endfor %}
                                    </table>
                        </td>
                        {% elif key2 == 'customer_details' %}

                            <td>
                                    <table>

                                        {% for val in value %}
{% if forloop.first %}
                                        <tr>

                    {% for header in val.keys %}

                        <th>{{ header|replace_underscore|title }}</th>
                    {% endfor %}
                                        </tr>
                {% endif %}
                                            <tr>
                                                {% for value in val.values %}

                                                <td>{{ value }}</td>
                                                {% endfor %}

                                            </tr>
                                        {% endfor %}
                                    </table>
                        </td>
                        {% else %}
                            <td>{{ value }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}

    </table>


      Allow to generate report?  &nbsp; &nbsp; &nbsp;

    <button class="exportToExcel btn btn-primary" id="report">Yes</button>
    <button class="btn btn-primary">No</button>

</div>

<script>
      $(function() {
        $(".exportToExcel").click(function(e){
          var table = $(this).prev('.table2excel');
          if(table && table.length){
            var preserveColors = (table.hasClass('table2excel_with_colors') ? true : false);
            $(table).table2excel({
              exclude: ".noExl",
              name: "Excel Document Name",
              filename: "myFileName" + new Date().toISOString().replace(/[\-\:\.]/g, "") + ".xls",
              fileext: ".xls",
              exclude_img: true,
              exclude_links: true,
              exclude_inputs: true,
              preserveColors: preserveColors
            });
          }
        });

      });
    </script>


<br>







</div>
    </div>
  </div>
  </div>
  <!-- End of Page Wrapper -->


  <script>
      function ExportToExcel(type, fn, dl) {
            var elt = document.getElementById('tbl_exporttable_to_xls');
            var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
            return dl ?
                XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }) :
                XLSX.writeFile(wb, fn || ('LeadReport.' + (type || 'xlsx')));
        }

    var tableToExcel = (function() {
      var uri = 'data:application/vnd.ms-excel;base64,'
        , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
        , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
        , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
      return function(table, name) {
        if (!table.nodeType) table = document.getElementById(table)
        var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
        window.location.href = uri + base64(format(template, ctx))
      }
    })()
    
    </script>

<script>
    /*
 *  jQuery table2excel - v1.1.2
 *  jQuery plugin to export an .xls file in browser from an HTML table
 *  https://github.com/rainabba/jquery-table2excel
 *
 *  Made by rainabba
 *  Under MIT License
 */
//table2excel.js
(function ( $, window, document, undefined ) {
    var pluginName = "table2excel",

    defaults = {
        exclude: ".noExl",
        name: "Table2Excel",
        filename: "table2excel",
        fileext: ".xls",
        exclude_img: true,
        exclude_links: true,
        exclude_inputs: true,
        preserveColors: false
    };

    // The actual plugin constructor
    function Plugin ( element, options ) {
            this.element = element;
            // jQuery has an extend method which merges the contents of two or
            // more objects, storing the result in the first object. The first object
            // is generally empty as we don't want to alter the default options for
            // future instances of the plugin
            //
            this.settings = $.extend( {}, defaults, options );
            this._defaults = defaults;
            this._name = pluginName;
            this.init();
    }

    Plugin.prototype = {
        init: function () {
            var e = this;

            var utf8Heading = "<meta http-equiv=\"content-type\" content=\"application/vnd.ms-excel; charset=UTF-8\">";
            e.template = {
                head: "<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\">" + utf8Heading + "<head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets>",
                sheet: {
                    head: "<x:ExcelWorksheet><x:Name>",
                    tail: "</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>"
                },
                mid: "</x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body>",
                table: {
                    head: "<table>",
                    tail: "</table>"
                },
                foot: "</body></html>"
            };

            e.tableRows = [];

      // Styling variables
      var additionalStyles = "";
      var compStyle = null;

            // get contents of table except for exclude
            $(e.element).each( function(i,o) {
                var tempRows = "";
                $(o).find("tr").not(e.settings.exclude).each(function (i,p) {

          // Reset for this row
          additionalStyles = "";

          // Preserve background and text colors on the row
          if(e.settings.preserveColors){
            compStyle = getComputedStyle(p);
            additionalStyles += (compStyle && compStyle.backgroundColor ? "background-color: " + compStyle.backgroundColor + ";" : "");
            additionalStyles += (compStyle && compStyle.color ? "color: " + compStyle.color + ";" : "");
          }

          // Create HTML for Row
                    tempRows += "<tr style='" + additionalStyles + "'>";

                    // Loop through each TH and TD
                    $(p).find("td,th").not(e.settings.exclude).each(function (i,q) { // p did not exist, I corrected

            // Reset for this column
            additionalStyles = "";

            // Preserve background and text colors on the row
            if(e.settings.preserveColors){
              compStyle = getComputedStyle(q);
              additionalStyles += (compStyle && compStyle.backgroundColor ? "background-color: " + compStyle.backgroundColor + ";" : "");
              additionalStyles += (compStyle && compStyle.color ? "color: " + compStyle.color + ";" : "");
            }

                        var rc = {
                            rows: $(this).attr("rowspan"),
                            cols: $(this).attr("colspan"),
                            flag: $(q).find(e.settings.exclude)
                        };

                        if( rc.flag.length > 0 ) {
                            tempRows += "<td> </td>"; // exclude it!!
                        } else {
                            tempRows += "<td";
                            if( rc.rows > 0) {
                                tempRows += " rowspan='" + rc.rows + "' ";
                            }
                            if( rc.cols > 0) {
                                tempRows += " colspan='" + rc.cols + "' ";
                            }
                            if(additionalStyles){
                tempRows += " style='" + additionalStyles + "'";
              }
                            tempRows += ">" + $(q).html() + "</td>";
                        }
                    });

                    tempRows += "</tr>";

                });
                // exclude img tags
                if(e.settings.exclude_img) {
                    tempRows = exclude_img(tempRows);
                }

                // exclude link tags
                if(e.settings.exclude_links) {
                    tempRows = exclude_links(tempRows);
                }

                // exclude input tags
                if(e.settings.exclude_inputs) {
                    tempRows = exclude_inputs(tempRows);
                }
                e.tableRows.push(tempRows);
            });

            e.tableToExcel(e.tableRows, e.settings.name, e.settings.sheetName);
        },

        tableToExcel: function (table, name, sheetName) {
            var e = this, fullTemplate="", i, link, a;

            e.format = function (s, c) {
                return s.replace(/{(\w+)}/g, function (m, p) {
                    return c[p];
                });
            };

            sheetName = typeof sheetName === "undefined" ? "Sheet" : sheetName;

            e.ctx = {
                worksheet: name || "Worksheet",
                table: table,
                sheetName: sheetName
            };

            fullTemplate= e.template.head;

            if ( $.isArray(table) ) {
                 Object.keys(table).forEach(function(i){
                      //fullTemplate += e.template.sheet.head + "{worksheet" + i + "}" + e.template.sheet.tail;
                      fullTemplate += e.template.sheet.head + sheetName + i + e.template.sheet.tail;
                });
            }

            fullTemplate += e.template.mid;

            if ( $.isArray(table) ) {
                 Object.keys(table).forEach(function(i){
                    fullTemplate += e.template.table.head + "{table" + i + "}" + e.template.table.tail;
                });
            }

            fullTemplate += e.template.foot;

            for (i in table) {
                e.ctx["table" + i] = table[i];
            }
            delete e.ctx.table;

            var isIE = navigator.appVersion.indexOf("MSIE 10") !== -1 || (navigator.userAgent.indexOf("Trident") !== -1 && navigator.userAgent.indexOf("rv:11") !== -1); // this works with IE10 and IE11 both :)
            //if (typeof msie !== "undefined" && msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // this works ONLY with IE 11!!!
            if (isIE) {
                if (typeof Blob !== "undefined") {
                    //use blobs if we can
                    fullTemplate = e.format(fullTemplate, e.ctx); // with this, works with IE
                    fullTemplate = [fullTemplate];
                    //convert to array
                    var blob1 = new Blob(fullTemplate, { type: "text/html" });
                    window.navigator.msSaveBlob(blob1, getFileName(e.settings) );
                } else {
                    //otherwise use the iframe and save
                    //requires a blank iframe on page called txtArea1
                    txtArea1.document.open("text/html", "replace");
                    txtArea1.document.write(e.format(fullTemplate, e.ctx));
                    txtArea1.document.close();
                    txtArea1.focus();
                    sa = txtArea1.document.execCommand("SaveAs", true, getFileName(e.settings) );
                }

            } else {
                var blob = new Blob([e.format(fullTemplate, e.ctx)], {type: "application/vnd.ms-excel"});
                window.URL = window.URL || window.webkitURL;
                link = window.URL.createObjectURL(blob);
                a = document.createElement("a");
                a.download = getFileName(e.settings);
                a.href = link;

                document.body.appendChild(a);

                a.click();

                document.body.removeChild(a);
            }

            return true;
        }
    };

    function getFileName(settings) {
        return ( settings.filename ? settings.filename : "table2excel" );
    }

    // Removes all img tags
    function exclude_img(string) {
        var _patt = /(\s+alt\s*=\s*"([^"]*)"|\s+alt\s*=\s*'([^']*)')/i;
        return string.replace(/<img[^>]*>/gi, function myFunction(x){
            var res = _patt.exec(x);
            if (res !== null && res.length >=2) {
                return res[2];
            } else {
                return "";
            }
        });
    }

    // Removes all link tags
    function exclude_links(string) {
        return string.replace(/<a[^>]*>|<\/a>/gi, "");
    }

    // Removes input params
    function exclude_inputs(string) {
        var _patt = /(\s+value\s*=\s*"([^"]*)"|\s+value\s*=\s*'([^']*)')/i;
        return string.replace(/<input[^>]*>|<\/input>/gi, function myFunction(x){
            var res = _patt.exec(x);
            if (res !== null && res.length >=2) {
                return res[2];
            } else {
                return "";
            }
        });
    }

    $.fn[ pluginName ] = function ( options ) {
        var e = this;
            e.each(function() {
                if ( !$.data( e, "plugin_" + pluginName ) ) {
                    $.data( e, "plugin_" + pluginName, new Plugin( this, options ) );
                }
            });

        // chain jQuery functions
        return e;
    };

})( jQuery, window, document );

</script>



								
							
							</div>
						</div>
					</div>
				</div>
										

			
				<!--end::Purchase-->
			</div>
			<!--end::Content-->
		</div>
		<!--end::Demo Panel-->
		<!--begin::Global Config(global config for global JS scripts)-->
		
		<!--end::Global Config-->
		<!--begin::Global Theme Bundle(used by all pages)-->
		<script src="{% static 'plugins/global/plugins.bundle.js' %}"></script>
<script src="{% static 'plugins/custom/prismjs/prismjs.bundle.js' %}"></script>
<script src="{% static 'js/scripts.bundle.js' %}"></script>
<!--end::Global Theme Bundle-->
<!--begin::Page Vendors(used by this page)-->
<script src="{% static 'plugins/custom/fullcalendar/fullcalendar.bundle.js' %}"></script>
<!--end::Page Vendors-->
<!--begin::Page Scripts(used by this page)-->
<script src="{% static 'js/pages/widgets.js' %}"></script>
		<!--end::Page Scripts-->
	</body>
	<!--end::Body-->
</html>